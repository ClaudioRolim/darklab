"use strict";(self.webpackChunkdarklab=self.webpackChunkdarklab||[]).push([[583],{3905:(e,a,t)=>{t.d(a,{Zo:()=>d,kt:()=>k});var l=t(7294);function s(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);a&&(l=l.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,l)}return t}function n(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){s(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function c(e,a){if(null==e)return{};var t,l,s=function(e,a){if(null==e)return{};var t,l,s={},r=Object.keys(e);for(l=0;l<r.length;l++)t=r[l],a.indexOf(t)>=0||(s[t]=e[t]);return s}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(l=0;l<r.length;l++)t=r[l],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var i=l.createContext({}),o=function(e){var a=l.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):n(n({},a),e)),t},d=function(e){var a=o(e.components);return l.createElement(i.Provider,{value:a},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var a=e.children;return l.createElement(l.Fragment,{},a)}},h=l.forwardRef((function(e,a){var t=e.components,s=e.mdxType,r=e.originalType,i=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),u=o(t),h=s,k=u["".concat(i,".").concat(h)]||u[h]||p[h]||r;return t?l.createElement(k,n(n({ref:a},d),{},{components:t})):l.createElement(k,n({ref:a},d))}));function k(e,a){var t=arguments,s=a&&a.mdxType;if("string"==typeof e||s){var r=t.length,n=new Array(r);n[0]=h;var c={};for(var i in a)hasOwnProperty.call(a,i)&&(c[i]=a[i]);c.originalType=e,c[u]="string"==typeof e?e:s,n[1]=c;for(var o=2;o<r;o++)n[o]=t[o];return l.createElement.apply(null,n)}return l.createElement.apply(null,t)}h.displayName="MDXCreateElement"},4193:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>i,contentTitle:()=>n,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>o});var l=t(7462),s=(t(7294),t(3905));const r={sidebar_position:3,sidebar_label:"Headscale"},n="Headscale",c={unversionedId:"tutorials/headscale",id:"tutorials/headscale",title:"Headscale",description:"---",source:"@site/docs/tutorials/headscale.md",sourceDirName:"tutorials",slug:"/tutorials/headscale",permalink:"/darklab/docs/tutorials/headscale",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorials/headscale.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,sidebar_label:"Headscale"},sidebar:"tutorialSidebar",previous:{title:"GitHub",permalink:"/darklab/docs/tutorials/github"},next:{title:"Linux",permalink:"/darklab/docs/tutorials/linux"}},i={},o=[{value:"<strong>SERVER Configuration</strong>",id:"server-configuration",level:2},{value:"1. Download Headscale Package",id:"1-download-headscale-package",level:3},{value:"2. Install Headscale",id:"2-install-headscale",level:3},{value:"3. Enable Headscale Service",id:"3-enable-headscale-service",level:3},{value:"4. Create Headscale Config",id:"4-create-headscale-config",level:3},{value:"5. Start headscale",id:"5-start-headscale",level:3},{value:"6. Stop Headscale",id:"6-stop-headscale",level:3},{value:"7. Headscale Status",id:"7-headscale-status",level:3},{value:"8. Create User",id:"8-create-user",level:3},{value:"9. Create Pre Authenticate Key",id:"9-create-pre-authenticate-key",level:3},{value:"<strong>CLIENT Configuration</strong>",id:"client-configuration",level:2},{value:"1. Install Tailscale",id:"1-install-tailscale",level:3},{value:"2. Run Tailscale",id:"2-run-tailscale",level:3},{value:"3. Link Registration",id:"3-link-registration",level:3},{value:"4. Register Node on Server",id:"4-register-node-on-server",level:3},{value:"HEADSCALE DOCKER",id:"headscale-docker",level:2},{value:"<strong>HEADSCALE CLI</strong>",id:"headscale-cli",level:2},{value:"\u2022 Launch Headscale",id:"-launch-headscale",level:3},{value:"\u2022 Test Metrics",id:"-test-metrics",level:3},{value:"\u2022 Create Users",id:"-create-users",level:3},{value:"\u2022 Create Pre Authentication Keys",id:"-create-pre-authentication-keys",level:3},{value:"\u2022 Show Ports",id:"-show-ports",level:3},{value:"\u2022 Nodes List",id:"-nodes-list",level:3},{value:"\u2022 Routes List",id:"-routes-list",level:3},{value:"<strong>TAILSCALE CLI</strong>",id:"tailscale-cli",level:2},{value:"Login Tailscale",id:"login-tailscale",level:3},{value:"Logout Tailscale",id:"logout-tailscale",level:3},{value:"Show Ip Route",id:"show-ip-route",level:3},{value:"Disconnect Tailscale",id:"disconnect-tailscale",level:3},{value:"Network Report Tailscale",id:"network-report-tailscale",level:3},{value:"Add Tailscale Preferences",id:"add-tailscale-preferences",level:3},{value:"Webserver Tailscaled",id:"webserver-tailscaled",level:3}],d={toc:o},u="wrapper";function p(e){let{components:a,...r}=e;return(0,s.kt)(u,(0,l.Z)({},d,r,{components:a,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"headscale"},"Headscale"),(0,s.kt)("hr",null),(0,s.kt)("blockquote",null,(0,s.kt)("blockquote",{parentName:"blockquote"},(0,s.kt)("p",{parentName:"blockquote"},"Project open source, self-hosted implementation derived from the ",(0,s.kt)("em",{parentName:"p"},"Tailscale Control Server,")," developed by Juan Font. Headscale is based on tailscale, so headscale is installed on the server and tailscale is installed on the client. Access the complete project: ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/juanfont/headscale"},(0,s.kt)("em",{parentName:"a"},"GitHub - Headscale"))))),(0,s.kt)("h2",{id:"server-configuration"},(0,s.kt)("strong",{parentName:"h2"},"SERVER Configuration")),(0,s.kt)("h3",{id:"1-download-headscale-package"},"1. Download Headscale Package"),(0,s.kt)("p",null,"Download the lastest headscale package .deb for linux Debian or Ubuntu: ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/juanfont/headscale/releases"},(0,s.kt)("em",{parentName:"a"},"Headscale Releases"))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"wget --output-document=headscale.deb \\\nhttps://github.com/juanfont/headscale/releases/download/v0.22.3/headscale_0.22.3_linux_amd64.deb\n")),(0,s.kt)("h3",{id:"2-install-headscale"},"2. Install Headscale"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"\u21b3")," from dpkg:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo dpkg -i headscale.deb\n")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"\u21b3")," from apt:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt-get install headscale.deb\n")),(0,s.kt)("h3",{id:"3-enable-headscale-service"},"3. Enable Headscale Service"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl enable headscale\n")),(0,s.kt)("h3",{id:"4-create-headscale-config"},"4. Create Headscale Config"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"nano /etc/headscale/config.yaml\n")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"\u21b3")," Use example configuration:  "),(0,s.kt)("p",null,(0,s.kt)("a",{target:"_blank",href:t(4217).Z},(0,s.kt)("em",null,"config-example.yaml"))),(0,s.kt)("h3",{id:"5-start-headscale"},"5. Start headscale"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl start headscale\n")),(0,s.kt)("h3",{id:"6-stop-headscale"},"6. Stop Headscale"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl stop headscale\n")),(0,s.kt)("h3",{id:"7-headscale-status"},"7. Headscale Status"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl status headscale\n")),(0,s.kt)("h3",{id:"8-create-user"},"8. Create User"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale users create <first-user>\n")),(0,s.kt)("h3",{id:"9-create-pre-authenticate-key"},"9. Create Pre Authenticate Key"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale --user <first-user> preauthkeys create --expiration 24h\n")),(0,s.kt)("h2",{id:"client-configuration"},(0,s.kt)("strong",{parentName:"h2"},"CLIENT Configuration")),(0,s.kt)("h3",{id:"1-install-tailscale"},"1. Install Tailscale"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt-get update\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt-get install tailscale\n")),(0,s.kt)("h3",{id:"2-run-tailscale"},"2. Run Tailscale"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo tailscale up --login-server <http://ip-server:port> authkey <preAuthKey> --accept-routes=true --accept-dns=false --advertise-routes=<ip/24>\n")),(0,s.kt)("h3",{id:"3-link-registration"},"3. Link Registration"),(0,s.kt)("p",null,"Click the link to register the node."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"To authenticate, visit:\n\n    https://login.tailscale.com/<device>\n")),(0,s.kt)("h3",{id:"4-register-node-on-server"},"4. Register Node on Server"),(0,s.kt)("p",null,"Go to server and register node."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale nodes register --user <first-user> --key <nodekey generated in login tailscale>\n")),(0,s.kt)("h2",{id:"headscale-docker"},"HEADSCALE DOCKER"),(0,s.kt)("h2",{id:"headscale-cli"},(0,s.kt)("strong",{parentName:"h2"},"HEADSCALE CLI")),(0,s.kt)("h3",{id:"-launch-headscale"},"\u2022 Launch Headscale"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl start headscale\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl restart headscale\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl stop headscale\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl status headscale\n")),(0,s.kt)("h3",{id:"-test-metrics"},"\u2022 Test Metrics"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"curl <htpp://ip:port>/metrics\n")),(0,s.kt)("h3",{id:"-create-users"},"\u2022 Create Users"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale users create <headscale-user>\n")),(0,s.kt)("h3",{id:"-create-pre-authentication-keys"},"\u2022 Create Pre Authentication Keys"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale --user <headscale-user> preauthkeys create --reusable --expiration <time-key>\n")),(0,s.kt)("h3",{id:"-show-ports"},"\u2022 Show Ports"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"ss -tlnp | grep headscale\n")),(0,s.kt)("h3",{id:"-nodes-list"},"\u2022 Nodes List"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale nodes list\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale --user <headscale-user> node register --key <nodekey generated in login tailscale>\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale node rename <node-name> -i <id-node>\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale node expire -i <id-node>\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale node delete -i <id-node>\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale node move -i <id-node>\n")),(0,s.kt)("h3",{id:"-routes-list"},"\u2022 Routes List"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale routes list\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale routes show\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale routes list -i <id>\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale route enable -r <id>\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale route disable -r <id>\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"headscale route delete -r <id>\n")),(0,s.kt)("h2",{id:"tailscale-cli"},(0,s.kt)("strong",{parentName:"h2"},"TAILSCALE CLI")),(0,s.kt)("h3",{id:"login-tailscale"},"Login Tailscale"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"tailscale up --login-server <http://ip:port> --accept-dns=false --accept-routes=true --advertise-routes=<ip/24>\n")),(0,s.kt)("h3",{id:"logout-tailscale"},"Logout Tailscale"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"tailscale logout\n")),(0,s.kt)("h3",{id:"show-ip-route"},"Show Ip Route"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"ip route sho table 52\n")),(0,s.kt)("h3",{id:"disconnect-tailscale"},"Disconnect Tailscale"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"tailscale down\n")),(0,s.kt)("h3",{id:"network-report-tailscale"},"Network Report Tailscale"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"tailscale netcheck\n")),(0,s.kt)("h3",{id:"add-tailscale-preferences"},"Add Tailscale Preferences"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"tailscale set <flags>\n")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"\u21b3")," Flags:  "),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"--accept-dns")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"--accept-risk=<risk>")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"-advertise-routes=")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"--accept-routes=<true or false>")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"--advertise-exit-node=<true or false>")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"--advertise-routes=<ip/24>")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"--ssh=true or false")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"-shields-up")),(0,s.kt)("h3",{id:"webserver-tailscaled"},"Webserver Tailscaled"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"tailscale web\n")))}p.isMDXComponent=!0},4217:(e,a,t)=>{t.d(a,{Z:()=>l});const l=t.p+"assets/files/config-example-c3434c48338668ee95b8103e2d579351.yaml"}}]);